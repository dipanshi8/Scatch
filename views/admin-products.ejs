<%- include('./partials/header') %>

<div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">Manage Products</h1>
            <div class="flex gap-4">
                <a href="/owners/admin/products/create" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition">
                    Add New Product
                </a>
                <a href="/owners/admin" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition">
                    Dashboard
                </a>
            </div>
        </div>
        
        <% if (products && products.length > 0) { %>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <% products.forEach(function(product) { %>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="h-48 flex items-center justify-center bg-<%= product.bgcolor || 'white' %>">
                            <% 
                            // Get image URL - prioritize images array, fallback to image field
                            let imageUrl = '';
                            if (product.images && product.images.length > 0) {
                                const primaryImage = product.images.find(img => img.isPrimary) || product.images[0];
                                imageUrl = primaryImage ? primaryImage.url : '';
                            }
                            if (!imageUrl && product.image) {
                                imageUrl = product.image;
                            }
                            // Ensure image path starts with / if it's a local path
                            if (imageUrl && !imageUrl.startsWith('http') && !imageUrl.startsWith('/') && !imageUrl.startsWith('data:')) {
                                imageUrl = '/' + imageUrl;
                            }
                            %>
                            <img src="<%= imageUrl %>" alt="<%= product.name %>" 
                                class="max-w-full max-h-full object-contain"
                                onerror="this.src='/images/bag-hanging-from-furniture-item-indoors.jpg'" />
                        </div>
                        <div class="p-4">
                            <h3 class="text-lg font-semibold mb-2"><%= product.name %></h3>
                            <p class="text-gray-600 mb-2">â‚¹<%= product.price %></p>
                            <p class="text-sm text-gray-500 mb-4">Stock: <%= product.stock || 0 %></p>
                            <div class="flex gap-2">
                                <a href="/owners/admin/products/edit/<%= product._id %>" class="flex-1 bg-blue-500 text-white text-center py-2 px-4 rounded hover:bg-blue-600 transition">
                                    Edit
                                </a>
                                <a href="/owners/admin/products/delete/<%= product._id %>" onclick="return confirm('Are you sure you want to delete this product?')" class="flex-1 bg-red-500 text-white text-center py-2 px-4 rounded hover:bg-red-600 transition">
                                    Delete
                                </a>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="bg-white rounded-lg shadow p-12 text-center">
                <h2 class="text-2xl font-semibold mb-4">No products yet</h2>
                <p class="text-gray-600 mb-6">Create your first product to get started!</p>
                <a href="/owners/admin/products/create" class="inline-block bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition">
                    Add New Product
                </a>
            </div>
        <% } %>
    </div>
</div>

<%- include('./partials/footer') %>

